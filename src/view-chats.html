<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="my-icons.html">

<dom-module id="view-chats">
  <template>
    <style>
      /* TODO: REMOVE EXCESS STYLES */
      :host {
        display: block;
        margin-bottom: 40px;
        font-weight: 300;
        width: 100%;
        margin: 0;
        padding: 0;
        color: var(--app-text-color);
      }

      ::-webkit-scrollbar {
          display: none;
      }

      ::-webkit-input-placeholder { /* Chrome/Opera/Safari */
        color: #000;
      }
      ::-moz-placeholder { /* Firefox 19+ */
        color: #000;
      }
      :-ms-input-placeholder { /* IE 10+ */
        color: #000;
      }
      :-moz-placeholder { /* Firefox 18- */
        color: #000;
      }

      h1 {
        color: var(--app-text-color);
        margin: 8px;
        font-size: 3vh;
      }

      input {
        display: flex;
        border: none;
        background: var(--app-secondary-color);
        height: 6vh;
        border-radius: 3px;
        color: #000;
        flex-grow: 8;
        margin: 8px;
        font-size: 3vh;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        padding: 8px;
        background: #FFF;
      }

      textarea:focus, input:focus {
        box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
        outline: none;
      }

      button {
        width: 30vw;
        min-width: 150px;
        height: 5vh;
        color: white;
        border-radius: 3px;
        border: none;
        font-size: 2.5vh;
        margin: 6px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        background: var(--app-primary-color);
      }

      button:hover {
        box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
        background: var(--app-accent-color);
      }

      button#logOut, button#theme {
        font-size: 2vh;
        height: 5vh;
        width: 5vh;
      }

      /* ID RULES  --- SORTED LINEAR */

      #panel {
        display: flex;
        flex-direction: column;
        height: 90vh;
        color: white;
        background: rebeccapurple;
      }

      .line {
        width: 100%;
        height: .5vh;
        border-radius: 3px;
        background: var(--app-primary-color);
      }

      #messages {
        display: flex;
        flex-direction: column;
        width: 100%;
        overflow-y: scroll;
        flex-grow: 8;
      }

      #bottom {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 8px;
      }

      #message {
        width: 90%;
        height: 5vh;
        border: none;
        border-radius: 3px;
        padding: 8px;
        font-size: 2vh;
      }

      /* CLASS RULES */

      .textMessage {
        display: flex;
        flex-direction: column;
        margin: 12px;
        min-height: 6vh;
      }

      .text {
        display: flex;
        align-items: center;
        background: var(--app-secondary-color);
        color: #FFF;
        border-radius: 10px;
        padding-left: 8px;
        padding-right: 8px;
        min-height: 5vh;
        max-width: 50%;
        overflow-y: visible;
        font-size: 2vh;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      }

      .name {
        position: relative;
        font-size: 2vh;
        padding-bottom: 6px;
      }

      .lower {
        display: flex;
      }
      #list {
        max-width: 100%;
        /* Hack to get around https://github.com/PolymerElements/iron-list/issues/329 */
        padding-top: 527px;
        margin-top: -527px;
        position: static;
      }
    </style>
    <h3>Chatting with: [[name]]</h3>

    <div id="panel">
      <div class="line"></div>

      <div id="messages">
      </div>
      <div class="line lower-line"></div>

      <div id="bottom">
        <input id="message" type="text" placeholder="Message" value="[[textMessage]]">
        <paper-icon-button icon="icons:chevron-right" on-click="_sendMessage"></paper-icon-button>
      </div>
    </div>

  </template>

  <script>
    Polymer({
      is: 'view-chats',
      behaviors: [
        Polymer.AppLocalizeBehavior
      ],

      properties: {
        chat: {
          type: String
        },

        ref: {
          type: String
        },

        uid: {
          type: String
        },

        posts: {
          type: Array
        },

        offline: {
          type: Boolean,
          value: false
        }
      },

      ready: function() {
        console.log('yo ' + this.ref);
      },

      computeBGImage: function (activity) {
        // console.log(activity);
        clean = activity.replace(/\s/g,'')
        return "background-image: url('../images/activities/" + activity + ".jpg');"
      },

      _getTitle: function(title) {
        return title || '';
      },

      _getDate: function(timestamp) {
        var date = new Date(timestamp);
        var seconds = Math.floor((new Date() - date) / 1000);

        if (seconds < 3600) {
          var minutes = Math.floor(seconds/60)
          return (minutes > 1) ? minutes + " minutes ago" : "1 minute ago";
        } else if (seconds < 86400) {
          var hours = Math.floor(seconds/3600)
          return (hours > 1) ? hours + " hours ago" : "1 hour ago";
        } else {
          var day = date.getDate();
          var monthIndex = date.getMonth();
          var year = date.getFullYear();
          return day + ' '  + monthNames[monthIndex] + ' ' + year;
        }
      },

      _sendMessage: function(evt) {
        console.log('send message');
        console.log(evt);
      }
    });
  </script>
</dom-module>
